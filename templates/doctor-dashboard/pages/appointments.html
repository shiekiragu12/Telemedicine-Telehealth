{% extends './../components/base.html' %}
{% load static %}
{% load customtags %}
{% block title %} Appointments {% endblock %}

{% load humanize %}

{% block styles %}
<link href="{% static 'dashboard/vendor/datatables/css/jquery.dataTables.min.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}

{% now "H" as current_hour %}

<div class="content-body">
	<!-- row -->
	<div class="container-fluid">
		<div class="form-head d-flex mb-3 mb-md-4 align-items-start">
			<div class="me-auto d-none d-lg-block">
				<h3 class="text-black font-w600 text-capitalize">Welcome Dr {{request.user.username}}</h3>
				<p class="mb-0 fs-18">
					{% if current_hour|add:"0" < 12 %} Good morning! {% elif current_hour|add:"0" < 18 %} Good
						afternoon! {% else %} Good evening! {% endif %} </p>
			</div>
		</div>
		<!-- Stats -->
		<div class="row">
			<div class="col-xl-4 col-xxl-4 col-sm-6">
				<div class="card gradient-bx text-white bg-info rounded">
					<div class="card-body">
						<div class="media align-items-center">
							<div class="media-body">
								<p class="mb-1">Appointments</p>
								<div class="d-flex flex-wrap">
									<h2 class="fs-40 font-w600 text-white mb-0 me-3">{{appointments|length}}</h2>
								</div>
							</div>
							<span class="border rounded-circle p-4">
								<i class="lni lni-calendar"></i>
							</span>
						</div>
					</div>
				</div>
			</div>
		</div>


		<div class="card">
			<div class="card-header">
				<h3>All Your Appointments</h3>
			</div>
			<div class="card-body">

				<form action="" class="mb-4">
					{% csrf_token %}
					<div class="row">
						<div class="col-md-2 mb-3">
							<div>
								<label for="" class="form-label">From Date</label>
								<input type="date" name="from_date" value="{{request.GET.from_date}}"
									class="form-control input-sm">
							</div>
						</div>
						<div class="col-md-2 mb-3">
							<div class="form-group-sm">
								<label for="" class="form-label">To Date</label>
								<input type="date" name="to_date" value="{{request.GET.to_date}}" class="form-control">
							</div>
						</div>
						<div class="col-md-3 mb-3">
							<div>
								<label for="" class="form-label">Appointment Type</label>
								<select name="type" id="" class="form-control">
									<option value="" {% if request.GET.type == '' %} selected {% endif %}>All</option>
									<option value="video" {% if request.GET.type == 'video' %} selected {% endif %}>Video</option>
									<option value="text" {% if request.GET.type == 'text' %} selected {% endif %}>Text</option>
								</select>
							</div>
						</div>
						<div class="col-md-3 mb-3">
							<div>
								<label for="" class="form-label">Appointment Category</label>
								<select name="category" id="" class="form-control">
									<option value="" {% if request.GET.category == '' %} selected {% endif %}>All</option>
									<option value="mental" {% if request.GET.category == 'mental' %} selected {% endif %}>Mental</option>
									<option value="medical" {% if request.GET.category == 'medical' %} selected {% endif %}>Medical</option>
								</select>
							</div>
						</div>
						<div class="col-md-2 mb-3">
							<div class="mb-2 h-100 d-flex align-items-center">
								<button class="btn btn-primary">Filter</button>
							</div>
						</div>
					</div>
				</form>
				<div class="table-responsive">
					<table id="appointments" class="display" style="width:100%">
						<thead>
							<tr>
								<th>Action</th>
								<th>Patient</th>
								<th>Note</th>
								<th>Consultation</th>
								<th>Date</th>
								<th>Start Time</th>
								<th>End Time</th>
							</tr>
						</thead>
						<tbody>
							{% for appointment in appointments %}
							{% include './../components/appointment-row.html' %}
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		</div>


	</div>
</div>

{% endblock %}

{% block scripts %}

<script src="{% static 'dashboard/vendor/datatables/js/jquery.dataTables.min.js' %}"></script>
<script>
	$('#appointments').DataTable({
		searching: false,
		paging: false,
		pageLength: 100
	})
</script>
{% endblock %}